# 1) Buat bridge (LAN + WLAN)
/interface bridge
add name=bridge1

/interface bridge port
add bridge=bridge1 interface=wlan1
add bridge=bridge1 interface=ether1    ;# ether1 = uplink ke Ruijie/pusat / Fortinet

# 2) IP manajemen Mikrotik
/ip address
add address=10.12.55.200/24 interface=bridge1 comment="IP manajemen"

# 3) Wireless SSID dengan password WPA2
/interface wireless security-profiles
add name=coretaxwifi authentication-types=wpa2-psk wpa2-pre-shared-key="@Pajak123"

/interface wireless set [ find default-name=wlan1 ] \
    ssid="Coretax" mode=ap-bridge disabled=no security-profile=coretaxwifi

# 4) Force DNS ke DNS pusat
/ip firewall nat
add chain=dstnat action=dst-nat to-addresses=10.254.28.30 to-ports=53 protocol=udp dst-port=53
add chain=dstnat action=dst-nat to-addresses=10.254.28.30 to-ports=53 protocol=tcp dst-port=53

# 5) Redirect HTTP + HTTPS ke captive portal (⚠️ bisa bikin SSL error)
/ip firewall nat
add chain=dstnat protocol=tcp dst-port=80 action=redirect to-ports=8080
add chain=dstnat protocol=tcp dst-port=443 action=redirect to-ports=8080

/ip proxy set enabled=yes port=8080
/ip proxy access add dst-host=!tpportal-mtra.intranet.pajak.go.id action=deny

# 6) Default route ke gateway kantor
/ip route
add gateway=10.12.55.254