# ===================================
# Mikrotik Bridge Mode + DHCP Server
# ether1 = uplink ke kantor (Fortinet)
# wlan1  = SSID Coretax
# Client WiFi dapat IP dari Mikrotik
# ===================================

# 1) Hapus semua setingan lama
/interface bridge remove [find]
/ip address remove [find]
/ip route remove [find]
/ip dhcp-server remove [find]
/ip pool remove [find]
/interface wireless security-profiles remove [find]

# 2) Buat bridge baru
/interface bridge
add name=bridge1

/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=wlan1

# 3) IP statis Mikrotik untuk manajemen
/ip address
add address=10.12.55.200/24 interface=bridge1 comment="IP manajemen Mikrotik"

# 4) Default route ke gateway Fortinet
/ip route
add gateway=10.12.55.254

# 5) DNS kantor
/ip dns
set servers=10.254.28.30 allow-remote-requests=yes

# 6) Wireless SSID Coretax dengan password
/interface wireless security-profiles
add name=securewifi mode=dynamic-keys authentication-types=wpa2-psk wpa2-pre-shared-key="@Pajak123"

/interface wireless set [ find default-name=wlan1 ] \
    ssid="Coretax" mode=ap-bridge disabled=no security-profile=securewifi

# 7) Pool DHCP untuk client WiFi
/ip pool
add name=pool-kantor ranges=10.12.55.50-10.12.55.150

# 8) DHCP server di bridge1
/ip dhcp-server
add name=dhcp-kantor interface=bridge1 address-pool=pool-kantor lease-time=12h disabled=no

/ip dhcp-server network
add address=10.12.55.0/24 gateway=10.12.55.254 dns-server=10.254.28.30